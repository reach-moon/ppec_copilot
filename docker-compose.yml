version: '3.8'

# ---------------------------------
# 服务定义 (services)
# ---------------------------------
services:
  # 1. 您的 PPEC Copilot 应用
  app:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # 使用国内镜像源加速构建
        PIP_INDEX_URL: https://pypi.tuna.tsinghua.edu.cn/simple/
        PIP_TRUSTED_HOST: pypi.tuna.tsinghua.edu.cn
    container_name: ppec_copilot_app
    restart: always
    env_file:
      - .env  # 注入环境变量
    networks:
      - ppec_internal_network # <--- 将 app 连接到我们的内部网络
    depends_on:
      - qdrant
      # 如果 Mem0 依赖 Qdrant，也需要加上
      # - qdrant
    ports:
      - "8000:8000"  # 映射端口以便外部访问

  # Qdrant 向量数据库 (Mem0 的依赖示例)
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant_db
    restart: always
    ports:
      - "6333:6333" # Qdrant gRPC 端口
    volumes:
      - qdrant_data:/qdrant/storage
    networks:
      - ppec_internal_network

# ---------------------------------
# 网络定义 (networks)
# ---------------------------------
networks:
  # 定义我们的共享内部网络
  ppec_internal_network:
    driver: bridge

# ---------------------------------
# 数据卷定义 (volumes)
# ---------------------------------
volumes:
  # 定义具名数据卷以持久化数据
  # ragflow_data:
  qdrant_data: