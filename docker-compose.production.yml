# docker-compose.production.yml
# Production deployment configuration for PPEC Copilot

version: '3.8'

services:
  # PPEC Copilot Application
  app:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Use Tsinghua University mirror for faster builds in China
        PIP_INDEX_URL: https://pypi.tuna.tsinghua.edu.cn/simple/
        PIP_TRUSTED_HOST: pypi.tuna.tsinghua.edu.cn
    container_name: ppec_copilot_app
    restart: always
    env_file:
      - .env.docker
    networks:
      - ppec_network
    depends_on:
      - qdrant
    ports:
      - "8000:8000"
    volumes:
      - app_logs:/home/appuser/app/logs

  # Qdrant Vector Database for Mem0
  qdrant:
    image: qdrant/qdrant:v1.15.1
    container_name: ppec_qdrant
    restart: always
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage
      - ./qdrant_config:/qdrant/config:ro
    networks:
      - ppec_network
    environment:
      - QDRANT__SERVICE__GRPC_PORT=6334

# Docker Networks
networks:
  ppec_network:
    driver: bridge

# Docker Volumes
volumes:
  app_logs:
  qdrant_data: